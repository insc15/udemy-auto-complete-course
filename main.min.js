"use strict";var __awaiter=this&&this.__awaiter||function(t,e,s,o){function n(i){return i instanceof s?i:new s(function(r){r(i)})}return new(s||(s=Promise))(function(i,r){function d(c){try{u(o.next(c))}catch(a){r(a)}}function l(c){try{u(o.throw(c))}catch(a){r(a)}}function u(c){c.done?i(c.value):n(c.value).then(d,l)}u((o=o.apply(t,e||[])).next())})},_a,_b,_c;const courseID=(_c=(_b=(_a=document.querySelector("div[data-module-id=course-taking]"))===null||_a===void 0?void 0:_a.getAttribute("data-module-args"))===null||_b===void 0?void 0:_b.match(/"course_id":(\d+)/))===null||_c===void 0?void 0:_c[1];function getLectures(t){return __awaiter(this,void 0,void 0,function*(){console.clear(),console.log("Getting lectures...");const o=(yield(yield fetch(`https://fpl.udemy.com/api-2.0/courses/${t}/subscriber-curriculum-items/?page_size=200&fields[lecture]=title,object_index,is_published,sort_order,created,asset,supplementary_assets,is_free&fields[quiz]=title,object_index,is_published,sort_order,type&fields[practice]=title,object_index,is_published,sort_order&fields[chapter]=title,object_index,is_published,sort_order&fields[asset]=title,filename,asset_type,status,time_estimation,is_external&caching_intent=True`)).json()).results.filter(n=>n._class==="lecture");return console.log("Got lectures"),o})}function getQuizzes(t){return __awaiter(this,void 0,void 0,function*(){console.clear(),console.log("Getting quizzes...");const o=(yield(yield fetch(`https://fpl.udemy.com/api-2.0/courses/${t}/subscriber-curriculum-items/?page_size=200&fields[lecture]=title,object_index,is_published,sort_order,created,asset,supplementary_assets,is_free&fields[quiz]=title,object_index,is_published,sort_order,type&fields[practice]=title,object_index,is_published,sort_order&fields[chapter]=title,object_index,is_published,sort_order&fields[asset]=title,filename,asset_type,status,time_estimation,is_external&caching_intent=True`)).json()).results.filter(n=>n._class==="quiz");return console.log("Got quizzes"),o})}function completeLecture(t){return __awaiter(this,void 0,void 0,function*(){t.forEach(e=>__awaiter(this,void 0,void 0,function*(){(yield fetch(`https://fpl.udemy.com/api-2.0/users/me/subscribed-courses/${courseID}/completed-lectures/`,{method:"POST",headers:{"content-type":"application/json;charset=UTF-8"},body:JSON.stringify({lecture_id:e.id,downloaded:!1})})).status===201&&console.log("Completed lecture: "+e.title)}))})}function completeQuiz(t){return __awaiter(this,void 0,void 0,function*(){console.log("Completing quizzes...");for(const e of t){console.log("Completing quiz: "+e.title);let s=null;try{const i=yield fetch(`https://fpl.udemy.com/api-2.0/users/me/subscribed-courses/${courseID}/quizzes/${e.id}/user-attempted-quizzes/latest/?fields[user_attempted_quiz]=id,created,viewed_time,completion_time,version,completed_assessments,results_summary`),{id:r}=yield i.json();if(!r||r.detail){const d=yield fetch(`https://fpl.udemy.com/api-2.0/users/me/subscribed-courses/${courseID}/quizzes/${e.id}/user-attempted-quizzes/?fields[user_attempted_quiz]=id,created,viewed_time,completion_time,version,completed_assessments,results_summary`,{method:"POST",headers:{"content-type":"application/json;charset=UTF-8"},body:JSON.stringify({is_viewed:!0})}),{id:l}=yield d.json();s=l}else s=r}catch(i){}const o=yield fetch(`https://fpl.udemy.com/api-2.0/quizzes/${e.id}/assessments/?version=1&page_size=250&fields[assessment]=id,assessment_type,prompt,correct_response,section,question_plain,related_lectures`,{method:"GET",headers:{"content-type":"application/json;charset=UTF-8"}}),{results:n}=yield o.json();for(const i of n)yield fetch(`https://fpl.udemy.com/api-2.0/users/me/subscribed-courses/${courseID}/user-attempted-quizzes/${s}/assessment-answers/`,{method:"POST",headers:{"content-type":"application/json;charset=UTF-8"},body:JSON.stringify({assessment_id:i.id,duration:15,response:JSON.stringify(i.correct_response)})})}})}getLectures(courseID).then(t=>{completeLecture(t).then(()=>{getQuizzes(courseID).then(e=>{completeQuiz(e).then(()=>{console.log("Done")})})})});
